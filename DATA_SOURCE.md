# 真实数据爬取实现说明

## 📡 已实现的真实数据源

### A 股市场数据

#### 1. 市场指数

- **数据源**: 新浪财经 API
- **接口**: `https://hq.sinajs.cn/list=sh000001,sz399001,sz399006`
- **覆盖指数**:
  - 上证指数 (sh000001)
  - 深证成指 (sz399001)
  - 创业板指 (sz399006)
- **更新频率**: 实时（延迟约 3 秒）

#### 2. 热门股票榜单

- **数据源**: 东方财富网 API
- **接口**: `http://push2.eastmoney.com/api/qt/clist/get`
- **支持榜单**:
  - 涨幅榜
  - 跌幅榜
  - 成交量榜
- **数据字段**: 股票代码、名称、价格、涨跌幅、成交量、换手率等
- **更新频率**: 实时

#### 3. 个股实时行情

- **数据源**: 新浪财经 API
- **接口**: `https://hq.sinajs.cn/list=sh600000` (示例)
- **包含数据**:
  - 实时价格、涨跌幅
  - 开盘价、最高价、最低价
  - 五档买卖盘口
  - 成交量、成交额
- **更新频率**: 实时

#### 4. K 线历史数据

- **数据源**: 新浪财经 K 线接口
- **接口**: `https://money.finance.sina.com.cn/quotes_service/api/json_v2.php/CN_MarketData.getKLineData`
- **支持周期**:
  - 日 K 线 (scale=240)
  - 周 K 线 (scale=1200)
  - 月 K 线 (scale=7200)
  - 60 分钟 (scale=60)
  - 30 分钟 (scale=30)
  - 15 分钟 (scale=15)
- **数据量**: 默认 100 条，可调整

#### 5. 主力资金流向

- **数据源**: 东方财富网 API
- **接口**: `http://push2.eastmoney.com/api/qt/clist/get`
- **参数**: `fid=f62` (按主力净流入排序)
- **包含数据**:
  - 主力净流入
  - 超大单、大单、中单、小单流向
  - 涨跌幅
- **更新频率**: 实时

### 美股市场数据

#### 1. 美股指数

- **数据源**: 新浪财经美股 API
- **接口**: `https://hq.sinajs.cn/list=gb_$dji,gb_ixic,gb_inx`
- **覆盖指数**:
  - 道琼斯指数 (gb\_$dji)
  - 纳斯达克指数 (gb_ixic)
  - 标普 500 指数 (gb_inx)
- **更新频率**: 实时（美股交易时间）

#### 2. 热门美股

- **数据源**: 新浪财经美股 API
- **覆盖股票**: AAPL, MSFT, GOOGL, AMZN, TSLA, META, NVDA 等 20 只
- **数据字段**: 实时价格、涨跌幅、成交量等
- **更新频率**: 实时

#### 3. 美股个股行情

- **数据源**: 新浪财经美股 API
- **接口**: `https://hq.sinajs.cn/list=gb_aapl` (示例)
- **支持功能**: 实时行情查询

#### 4. 美股 K 线数据

- **数据源**: 新浪财经美股 K 线接口
- **支持周期**: 日 K、周 K、月 K
- **注意**: K 线数据获取可能受限

## 🔧 技术实现

### 数据爬取策略

```typescript
// 1. 使用 axios 发送 HTTP 请求
const apiClient = axios.create({
  timeout: 10000,
  headers: {
    "User-Agent": "Mozilla/5.0...",
  },
});

// 2. 解析响应数据
const response = await apiClient.get(url, { params });
const data = parseResponse(response.data);

// 3. 格式化为统一数据结构
return formatData(data);
```

### 跨域处理

在 `next.config.js` 中配置了 CORS 头：

```javascript
async headers() {
  return [
    {
      source: '/api/:path*',
      headers: [
        { key: 'Access-Control-Allow-Origin', value: '*' },
        // ...其他配置
      ],
    },
  ]
}
```

### 自动刷新机制

```typescript
useEffect(() => {
  fetchData(); // 立即获取数据
  const interval = setInterval(fetchData, 30000); // 每30秒刷新
  return () => clearInterval(interval); // 清理定时器
}, []);
```

## 📊 数据展示

### A 股市场页面 (`/a-share`)

✅ 三大指数实时显示
✅ 涨幅榜/跌幅榜/成交量榜切换
✅ 真实股票数据，点击可查看详情

### A 股个股详情 (`/a-share/stock/[code]`)

✅ 实时行情数据
✅ 多周期 K 线图
✅ 五档买卖盘口
✅ 成交量柱状图

### 主力资金页面 (`/capital-flow`)

✅ 真实主力资金流向数据
✅ 超大单/大单/中单/小单分析
✅ 支持多维度排序

### 美股市场页面 (`/us-market`)

✅ 道琼斯、纳斯达克、标普 500 指数
✅ 热门美股实时行情
✅ 点击可查看个股详情

### 美股个股详情 (`/us-market/stock/[symbol]`)

✅ 美股实时行情
✅ K 线图展示（可能受限）
✅ 以美元显示价格

## ⚠️ 注意事项

### 1. 数据延迟

- 免费 API 可能有 3-5 秒延迟
- 非交易时间显示上一交易日数据

### 2. 请求频率限制

- 新浪财经 API 有频率限制
- 建议不要过于频繁刷新
- 已设置合理的刷新间隔（30-60 秒）

### 3. 跨域问题

- 部分 API 可能需要服务端代理
- Next.js API 路由自动处理跨域

### 4. 数据准确性

- 免费 API 数据仅供参考
- 投资决策请以官方数据为准
- 生产环境建议使用付费数据服务

### 5. API 稳定性

- 第三方免费 API 可能不稳定
- 已添加错误处理和降级方案
- 部分数据获取失败会显示友好提示

## 🚀 使用建议

### 开发环境

```bash
# 启动开发服务器
npm run dev

# 访问应用
http://localhost:3000
```

### 测试数据

1. **A 股市场**: 访问 `/a-share` 查看实时数据
2. **个股详情**: 点击任意股票卡片
3. **主力资金**: 访问 `/capital-flow` 查看资金流向
4. **美股市场**: 访问 `/us-market` 查看美股数据

### 常见股票代码

- **A 股**: 600000(浦发银行), 000001(平安银行), 300750(宁德时代)
- **美股**: AAPL(苹果), TSLA(特斯拉), GOOGL(谷歌)

## 📈 数据更新频率

| 数据类型 | 更新频率 | 说明         |
| -------- | -------- | ------------ |
| A 股指数 | 30 秒    | 交易时间实时 |
| A 股个股 | 10 秒    | 交易时间实时 |
| 热门榜单 | 30 秒    | 动态更新     |
| 主力资金 | 30 秒    | 交易时间更新 |
| 美股指数 | 60 秒    | 美股交易时间 |
| 美股个股 | 30 秒    | 美股交易时间 |

## 🔮 未来优化方向

1. **WebSocket 推送**: 实现真正的实时数据推送
2. **数据缓存**: 减少 API 调用次数
3. **付费 API**: 接入更稳定的数据服务
4. **历史数据**: 支持更长周期的历史数据查询
5. **技术指标**: 添加 MACD、KDJ、RSI 等技术指标

## 📞 技术支持

如遇到数据显示问题：

1. 检查网络连接
2. 确认是否在交易时间
3. 查看浏览器控制台错误信息
4. 尝试刷新页面
